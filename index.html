<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Drone Animation with Cesium</title>
    <link rel="stylesheet" href="libs/cesium/Widgets/widgets.css">
    <style>
        #cesiumContainer {
            width: 100%;
            height: 100vh;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="cesiumContainer"></div>
    <script src="libs/cesium/Cesium.js"></script>
    <script>
        // Configura Cesium Viewer
        var viewer = new Cesium.Viewer('cesiumContainer', {
            animation: false,
            timeline: false
        });

        // Coordinati delle tappe
        const locations = [
            { lat: 46.0711, lon: 13.2348, name: "Udine" },
            { lat: 44.4949, lon: 11.3426, name: "Bologna" },
            { lat: -47.7500, lon: -65.9000, name: "Puerto Deseado" },
            { lat: 53.3498, lon: -6.2603, name: "Dublino" },
            { lat: 51.0504, lon: 13.7373, name: "Dresda" },
            { lat: 50.0755, lon: 14.4378, name: "Praga" }
        ];

        // Aggiungi le località alla mappa con punti neri e nomi
        locations.forEach(location => {
            viewer.entities.add({
                name: location.name,
                position: Cesium.Cartesian3.fromDegrees(location.lon, location.lat, 100),
                point: {
                    pixelSize: 10,
                    color: Cesium.Color.BLACK
                },
                label: {
                    text: location.name,
                    font: '14pt sans-serif',
                    style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                    outlineWidth: 2,
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                    pixelOffset: new Cesium.Cartesian2(0, -20),
                    fillColor: Cesium.Color.BLACK
                }
            });
        });

        // Aggiungi i punti alla mappa con il segno grafico personalizzato
        var droneEntity = viewer.entities.add({
            name: 'Drone',
            position: Cesium.Cartesian3.fromDegrees(locations[0].lon, locations[0].lat, 100),
            point: {
                pixelSize: 10, // Dimensione del segno grafico
                color: Cesium.Color.RED // Colore del segno grafico
            }
        });

        // Funzione per aggiungere una pausa tra i voli
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Funzione per animare il drone
        async function animateDrone() {
            for (let i = 0; i < locations.length; i++) {
                let location = locations[i];
                droneEntity.position = Cesium.Cartesian3.fromDegrees(location.lon, location.lat, 100);
                viewer.camera.flyTo({
                    destination: Cesium.Cartesian3.fromDegrees(location.lon, location.lat, 1000000),
                    duration: 5 // Durata del volo in secondi
                });
                await sleep(6000); // Attendi il completamento del volo
                await sleep(1000); // Pausa di 1 secondo
            }
            // Ripeti l'animazione
            animateDrone();
        }

        // Avvia l'animazione quando il viewer è pronto
        viewer.scene.postRender.addEventListener(() => {
            if (!animateDroneStarted) {
                animateDroneStarted = true;
                animateDrone();
            }
        });

        let animateDroneStarted = false;
    </script>
</body>
</html>
