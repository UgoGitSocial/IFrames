<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Drone Animation with Cesium</title>
    <link rel="stylesheet" href="libs/leaflet/leaflet.css">
    <style>
        #cesiumContainer {
            width: 100%;
            height: 100vh;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="cesiumContainer"></div>
    <script src="libs/leaflet/leaflet.js"></script>
    <script>
        // Configura Leaflet Map
        var mymap = L.map('cesiumContainer').setView([46.0711, 13.2348], 5);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
        }).addTo(mymap);

        // Coordinati delle tappe
        const locations = [
            { lat: 46.0711, lon: 13.2348, name: "Udine" },
            { lat: 44.4949, lon: 11.3426, name: "Bologna" },
            { lat: -47.7500, lon: -65.9000, name: "Puerto Deseado" },
            { lat: 53.3498, lon: -6.2603, name: "Dublino" },
            { lat: 51.0504, lon: 13.7373, name: "Dresda" },
            { lat: 50.0755, lon: 14.4378, name: "Praga" }
        ];

        // Aggiungi le località alla mappa con punti neri e nomi
        locations.forEach(location => {
            L.marker([location.lat, location.lon]).addTo(mymap)
                .bindPopup(location.name);
        });

        // Funzione per animare il drone
        async function animateDrone() {
            for (let i = 0; i < locations.length; i++) {
                let location = locations[i];
                await panToLocation(location.lat, location.lon, 3);
                await zoomToLocation(location.lat, location.lon, 10, 2);
            }
            animateDrone();
        }

        // Funzione per effettuare lo zoom sulla località
        async function zoomToLocation(lat, lon, zoomLevel, durationSeconds) {
            return new Promise(resolve => {
                mymap.flyTo([lat, lon], zoomLevel, {
                    duration: durationSeconds * 1000,
                    animate: true,
                    easeLinearity: 0.5,
                    noMoveStart: true,
                    maxZoom: zoomLevel
                });
                setTimeout(resolve, durationSeconds * 1000);
            });
        }

        // Funzione per effettuare il pan sulla località
        async function panToLocation(lat, lon, durationSeconds) {
            return new Promise(resolve => {
                mymap.flyTo([lat, lon], mymap.getZoom(), {
                    duration: durationSeconds * 1000,
                    animate: true,
                    easeLinearity: 0.5,
                    noMoveStart: true
                });
                setTimeout(resolve, durationSeconds * 1000);
            });
        }

        // Avvia l'animazione quando il viewer è pronto
        animateDrone();
    </script>
</body>
</html>
